<?= it.partial( it._assets ) ?>

<? it.title = '三十而立 sincerely music | (藝人名稱) - (專輯名稱)'; ?>
<? it.nav_selected = 'releases'; ?>
<? it.admin_view = 'edit'; ?>

<div id="main">
  <h3 id="release-name"><?= it.release.name ?></h3>
  <span id="release-date"><?= it.release.release_date ?></span>
  <div id="release-intro">
    <?= it.markdown( it.release.desc ) ?>

    <? if( it.release.artists.length ){ ?>
      <p id="related-artists">
        相關藝人：
        <? it.release.artists.forEach( function ( artist_name, index ){ ?>
          <a href="<?= it.namespace ?>/news?artist=<?- artist_name ?>" title="與<?= artist_name ?>相關的新聞"><?= artist_name ?></a><?= index == ( it.release.artists.length - 1 ) ? '' : ', ' ?>
        <? }); ?>
      </p>
    <? } ?>
  </div>

  <?
    var songs = [ '', '', '', '', '', '', '', '' ];
    var count = 3;
  ?>

  <? if( it.admin_view == 'new' ){ ?>
    <form class="songs-form" action="/admin/releases/mongo_id/songs/create" method="POST" accept-charset="UTF-8">
      <?= it.partial( 'admin/songs/_fields' ) ?>
    </form>
  <? } ?>

  <div id="songs">
    <ul class="songs-list">
      <li class="songs-item">
        <a class="song-link" href="/releases/mongo_id/songs/show">ASUS 華碩與三十而立</a>
        <span class="song-number">1.</span>
        <span class="song-length">3:49</span>
        <a class="song-itunes-link" href="/releases/show?itunes-link=111">Download on iTunes</a>

        <? if( it.is_authenticated ){ ?>
          <a class="link-edit" href="/admin/releases/mongo_id/songs/mongo_id/edit">EDIT THIS ENTRY</a>
        <? } ?>
      </li>

      <!-- this if is for temp, use mongo id to check if this song is the current song -->
      <? if( it.admin_view == 'edit' ){ ?>
        <form class="songs-form-delete" action="/admin/releases" method="POST" accept-charset="UTF-8">
          <input type="hidden" name="_method" value="delete" />
          <input type="hidden" name="_csrf" value="<?= it.csrf ?>" />
          <input class="songs-btn-delete" type="submit" value="DELETE THIS ENTRY" />
        </form>

        <form class="songs-form-edit" action="/admin/releases/mongo_id/songs/" method="POST" accept-charset="UTF-8">
          <input type="hidden" name="_method" value="put" />
          <?= it.partial( 'admin/songs/_fields' ) ?>
        </form>
      <? }else{ ?>
        <li class="songs-item">
          <a class="song-link" href="/releases/mongo_id/songs/show">ASUS 華碩與三十而立</a>
          <span class="song-number">2.</span>
          <span class="song-length">3:49</span>
          <a class="song-itunes-link" href="/releases/show?itunes-link=111">Download on iTunes</a>

          <a class="link-edit" href="/admin/releases/mongo_id/songs/mongo_id/edit">EDIT THIS ENTRY</a>
        </li>
      <? } ?>

      <? songs.forEach( function ( song ){ ?>
        <li class="songs-item">
          <a class="song-link" href="/releases/mongo_id/songs/show">ASUS 華碩與三十而立</a>
          <span class="song-number"><?= count ?>.</span>
          <span class="song-length">3:49</span>
          <a class="song-itunes-link" href="/releases/show?itunes-link=111">Download on iTunes</a>

          <? if( it.is_authenticated ){ ?>
            <a class="link-edit" href="/admin/releases/mongo_id/songs/mongo_id/edit">EDIT THIS ENTRY</a>
          <? } ?>
        </li>
      <?
          count++;
        });
      ?>
    </ul>

    <!-- this if is for temp, still figuring out better way to decide when to show add link -->
    <? if(( it.admin_view !== 'new' ) && ( it.admin_view !== 'edit' )){ ?>
      <a href="/" id="btn-add">ADD NEW SONG</a>
    <? } ?>
  </div>

  <? if( it.is_authenticated ){ ?>
    <a id="link-edit" href="/admin/releases/<?= it.release._id ?>/edit">EDIT THIS ENTRY</a>
    <form class="form-delete" action="/admin/releases/<?= it.release._id ?>" method="POST" accept-charset="UTF-8">
      <input type="hidden" name="_method" value="delete" />
      <input type="hidden" name="_csrf" value="<?= it.csrf ?>" />
      <input class="btn-delete" type="submit" value="DELETE THIS ENTRY" />
    </form>
  <? } ?>
</div>

<div id="sidebar">
  <img id="release-cover" src="<?= it.release.cover ?>" alt="cover">
  <!-- soundcloud player goes here -->
  <iframe
    width="232px"
    height="59px"
    scrolling="no"
    frameborder="no"
    src="https://w.soundcloud.com/player/?url=http%3A%2F%2Fapi.soundcloud.com%2Fplaylists%2F1983744&amp;color=75d0dc&amp;auto_play=false&amp;show_artwork=true">
  </iframe>
</div>